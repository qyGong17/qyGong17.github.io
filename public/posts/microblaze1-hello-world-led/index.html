<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Microblaze1 Hello World LED | QY's Notes</title><meta name=keywords content="microblaze"><meta name=description content="1 Introduction This post is a step-by-step guide implementing a blinking LED project with MicroBlaze:
Create a minimal MicroBlaze project Sample code for blinking LED (based on a Xilinx demo) Implementation on the demo board I am new to FPGA and MicroBlaze, and I learned these all from the tutorials I found. References are at the end.
I used:
Device: xc7a35tfgg484-2, (an Artix-7 Mini board made by a Chinese company, Wildfire) Vivado 2018."><meta name=author content="QY"><link rel=canonical href=qygong17.github.io/posts/microblaze1-hello-world-led/><meta name=google-site-verification content="qygong17"><meta name=yandex-verification content="qygong17"><meta name=msvalidate.01 content="qygong17"><link crossorigin=anonymous href=/qygong17.github.io/assets/css/stylesheet.6724e1566f50498fe2cb86b4a21e9c3a422ce04f72d9ff3c46cc2bdb10be5ac0.css integrity="sha256-ZyThVm9QSY/iy4a0oh6cOkIs4E9y2f88Rswr2xC+WsA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/qygong17.github.io/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=/assets/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/assets/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/assets/favicon-32x32.png><link rel=apple-touch-icon href=/assets/apple-touch-icon.png><link rel=mask-icon href=qygong17.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous referrerpolicy=no-referrer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous referrerpolicy=no-referrer type=text/javascript></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous referrerpolicy=no-referrer type=text/javascript></script>
<script type=text/javascript>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})})</script><meta property="og:title" content="Microblaze1 Hello World LED"><meta property="og:description" content="1 Introduction This post is a step-by-step guide implementing a blinking LED project with MicroBlaze:
Create a minimal MicroBlaze project Sample code for blinking LED (based on a Xilinx demo) Implementation on the demo board I am new to FPGA and MicroBlaze, and I learned these all from the tutorials I found. References are at the end.
I used:
Device: xc7a35tfgg484-2, (an Artix-7 Mini board made by a Chinese company, Wildfire) Vivado 2018."><meta property="og:type" content="article"><meta property="og:url" content="qygong17.github.io/posts/microblaze1-hello-world-led/"><meta property="og:image" content="qygong17.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-20T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-20T00:00:00+00:00"><meta property="og:site_name" content="QY's Notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="qygong17.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Microblaze1 Hello World LED"><meta name=twitter:description content="1 Introduction This post is a step-by-step guide implementing a blinking LED project with MicroBlaze:
Create a minimal MicroBlaze project Sample code for blinking LED (based on a Xilinx demo) Implementation on the demo board I am new to FPGA and MicroBlaze, and I learned these all from the tutorials I found. References are at the end.
I used:
Device: xc7a35tfgg484-2, (an Artix-7 Mini board made by a Chinese company, Wildfire) Vivado 2018."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"qygong17.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Microblaze1 Hello World LED","item":"qygong17.github.io/posts/microblaze1-hello-world-led/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Microblaze1 Hello World LED","name":"Microblaze1 Hello World LED","description":"1 Introduction This post is a step-by-step guide implementing a blinking LED project with MicroBlaze:\nCreate a minimal MicroBlaze project Sample code for blinking LED (based on a Xilinx demo) Implementation on the demo board I am new to FPGA and MicroBlaze, and I learned these all from the tutorials I found. References are at the end.\nI used:\nDevice: xc7a35tfgg484-2, (an Artix-7 Mini board made by a Chinese company, Wildfire) Vivado 2018.","keywords":["microblaze"],"articleBody":"1 Introduction This post is a step-by-step guide implementing a blinking LED project with MicroBlaze:\nCreate a minimal MicroBlaze project Sample code for blinking LED (based on a Xilinx demo) Implementation on the demo board I am new to FPGA and MicroBlaze, and I learned these all from the tutorials I found. References are at the end.\nI used:\nDevice: xc7a35tfgg484-2, (an Artix-7 Mini board made by a Chinese company, Wildfire) Vivado 2018.3 2 In Vivado New RTL project and select the correct device.\n2.1 New Block Design IP integrator-Create Block Design. 2.2 Add MicroBlaze IP Run Block Automation:\nChoose New Clocking Wizard, because the board has a 50 MHz input clock, and the microblaze core seems to need a 100 MHz clock. Other setting default. After block automation, a few other IPs are added and connected: 2.3 Clocking wizard Input Clock-Source-single ended clock capable , also, correct frequency, 50 MHz. Output Clocks-Reset Type-select Active Low, to matching the schematics below (KEY1 is Low when the button is pushed): 2.4 Connection Automation Run Connection Automation: (I don’t know how this button can be accessed from the menu…)\nInput ports for reset and clock are added automatically:\nThe generated port name was clk_100MHZ, I changed it to clk_50MHZ, to avoid confusion Two reset ports were generated, and I merged them into one. Regenerate Layout: useful button to organize the schematics.\n2.5 Add AXI_GPIO Add AXI_GPIO IP. I have 4 user LEDs on the board, so I selected GPIO Width=4, and All Outputs. Run Connection Automation again, GPIO IP is automaticly connected to the Microblaze system, meanwhile, an output port was added to the block dragram. 2.6 Validate Design Successful.\n2.7 Create wrapper (top level design) Automaticaly generate a top level design for the project. The final structure: top-mb1-all the IPs The generated wrapper:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 module mb1_wrapper (clk_50MHz, led_tri_o, reset_rtl_0); input clk_50MHz; output [3:0]led_tri_o; input reset_rtl_0; wire clk_50MHz; wire [3:0]led_tri_o; wire reset_rtl_0; mb1 mb1_i (.clk_50MHz(clk_50MHz), .led_tri_o(led_tri_o), .reset_rtl_0(reset_rtl_0)); endmodule 2.8 Define Contraints Run Synthesis From the top menus, layout-I/O planning Assign correct package pins and I/O standard for reset button, (read the schematics or documentations of your board) Save the constraint .xdc file. generated .xdc file :\nset_property PACKAGE_PIN W19 [get_ports clk_50MHz]\rset_property IOSTANDARD LVCMOS33 [get_ports clk_50MHz]\rset_property PACKAGE_PIN N20 [get_ports {led_tri_o[0]}]\rset_property PACKAGE_PIN M20 [get_ports {led_tri_o[1]}]\rset_property PACKAGE_PIN N22 [get_ports {led_tri_o[2]}]\rset_property PACKAGE_PIN M22 [get_ports {led_tri_o[3]}]\rset_property IOSTANDARD LVCMOS33 [get_ports {led_tri_o[3]}]\rset_property IOSTANDARD LVCMOS33 [get_ports {led_tri_o[2]}]\rset_property IOSTANDARD LVCMOS33 [get_ports {led_tri_o[1]}]\rset_property IOSTANDARD LVCMOS33 [get_ports {led_tri_o[0]}]\rset_property IOSTANDARD LVCMOS33 [get_ports reset_rtl_0]\rset_property PACKAGE_PIN R16 [get_ports reset_rtl_0] 2.9 Bitstream Generation All default settings:\nImplementation Generate bitstream 2.10 Export Hardware File-export-export Hardware with default settings.\n2.11 Open SDK File-Launch SDK\n3 In SDK 3.1 New Application Project In SDK, New-Application Project Finish, create an empty project 3.2 Add Sample Code Add main.c at src directory. main.c:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 #include #include \"xil_printf.h\" #include \"xgpio.h\" #include \"xparameters.h\" //for device id XGpio led_gpio; #define LED_DELAY 5000000 #define LED_CHANNEL 1 #define DIR_OUTPUT 0 int main() { volatile int counter; int status; // XPAR_GPIO_LED_DEVICE_ID: see xparameters.h // GPIO_LED is the name of the AXI_GPIO IP from Vivado status = XGpio_Initialize(\u0026led_gpio, XPAR_GPIO_LED_DEVICE_ID); if(status != XST_SUCCESS) //if status!=0 { //comment out xil_printf, because the RAM was small, 8KB //xil_printf(\"Gpio Initialization Failed\\r\\n\"); return XST_FAILURE; //return 1 } XGpio_SetDataDirection(\u0026led_gpio, LED_CHANNEL, DIR_OUTPUT); //all bits as output while(1) { // Set the GPIO bits to High XGpio_DiscreteWrite(\u0026led_gpio, LED_CHANNEL, 0x0F); for(counter=0; counter\u003cLED_DELAY;counter++); //delay // Set the GPIO bits to Low XGpio_DiscreteWrite(\u0026led_gpio, LED_CHANNEL, 0x00); for(counter=0; counter\u003cLED_DELAY;counter++); //delay } return XST_SUCCESS; } For initialization of GPIO, refer to xgpio_example.c: gpio: xgpio_example.c File Reference For device id, look for GPIO_LED (the name of AXI_GPIO ip from Vivado Block Design) in xparameters.h: 1 2 #define XPAR_GPIO_LED_DEVICE_ID 0 #define XPAR_GPIO_0_DEVICE_ID XPAR_GPIO_LED_DEVICE_ID 3.3 Debug 3.3.1 Run Configuration 3.3.2 Build Project Project-Build All\n3.3.3 Program FPGA Right click Project led-Run as-Launch on Hardware.\nAfter a few seconds, the LEDs should be blinking. Basically, the SDK is just like other IDEs for ARM or TI DSP, though I haven’t used these in a while, either.\n4 Links Maybe I should have used a newer Vivado version:\nStarting in the 2019.2 release, the Xilinx SDK development environment is unified into an all-in-one Vitis™ unified software platform.\nMost of the steps are from this video: Digilent Nexys: Microblaze and GPIO Design Implementation - YouTube Another toturial: MicroBlaze Quickstart Video volatile int: declaration - Why is volatile needed in C? - Stack Overflow volatile tells the compiler not to optimize anything that has to do with the volatile variable. MicroBlaze - section .text will not fit in region (xilinx.com) Step By Step Guide To Xilinx SDK Project Migration To Vitis gpio: xgpio_example.c File Reference search for xgpio_example.c inside the Vivado installation directory. ","wordCount":"843","inLanguage":"en","datePublished":"2023-05-20T00:00:00Z","dateModified":"2023-05-20T00:00:00Z","author":{"@type":"Person","name":"QY"},"mainEntityOfPage":{"@type":"WebPage","@id":"qygong17.github.io/posts/microblaze1-hello-world-led/"},"publisher":{"@type":"Organization","name":"QY's Notes","logo":{"@type":"ImageObject","url":"/assets/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=qygong17.github.io accesskey=h title="QY's Notes (Alt + H)">QY's Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=qygong17.github.io/qygong17.github.io/about/ title=About><span>About</span></a></li><li><a href=qygong17.github.io/qygong17.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=qygong17.github.io/qygong17.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=qygong17.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=qygong17.github.io>Home</a>&nbsp;»&nbsp;<a href=qygong17.github.io/posts/>Posts</a></div><h1 class=post-title>Microblaze1 Hello World LED</h1><div class=post-meta><span title='2023-05-20 00:00:00 +0000 UTC'>May 20, 2023</span>&nbsp;·&nbsp;QY&nbsp;·&nbsp;<a href=/tags/microblaze> microblaze</a>&nbsp;|&nbsp;<a href=https://github.com/qyGong17/qyGong17.github.io/tree/main/content/posts/Microblaze1%20Hello%20World%20LED.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-introduction aria-label="1 Introduction">1 Introduction</a></li><li><a href=#2-in-vivado aria-label="2 In Vivado">2 In Vivado</a><ul><li><a href=#21-new-block-design aria-label="2.1 New Block Design">2.1 New Block Design</a></li><li><a href=#22-add-microblaze-ip aria-label="2.2 Add MicroBlaze IP">2.2 Add MicroBlaze IP</a></li><li><a href=#23-clocking-wizard aria-label="2.3 Clocking wizard">2.3 Clocking wizard</a></li><li><a href=#24-connection-automation aria-label="2.4 Connection Automation">2.4 Connection Automation</a></li><li><a href=#25-add-axi_gpio aria-label="2.5 Add AXI_GPIO">2.5 Add AXI_GPIO</a></li><li><a href=#26-validate-design aria-label="2.6 Validate Design">2.6 Validate Design</a></li><li><a href=#27-create-wrapper-top-level-design aria-label="2.7 Create wrapper (top level design)">2.7 Create wrapper (top level design)</a></li><li><a href=#28-define-contraints aria-label="2.8 Define Contraints">2.8 Define Contraints</a></li><li><a href=#29-bitstream-generation aria-label="2.9 Bitstream Generation">2.9 Bitstream Generation</a></li><li><a href=#210-export-hardware aria-label="2.10 Export Hardware">2.10 Export Hardware</a></li><li><a href=#211-open-sdk aria-label="2.11 Open SDK">2.11 Open SDK</a></li></ul></li><li><a href=#3-in-sdk aria-label="3 In SDK">3 In SDK</a><ul><li><a href=#31-new-application-project aria-label="3.1 New Application Project">3.1 New Application Project</a></li><li><a href=#32-add-sample-code aria-label="3.2 Add Sample Code">3.2 Add Sample Code</a></li><li><a href=#33-debug aria-label="3.3 Debug">3.3 Debug</a><ul><li><a href=#331-run-configuration aria-label="3.3.1 Run Configuration">3.3.1 Run Configuration</a></li><li><a href=#332-build-project aria-label="3.3.2 Build Project">3.3.2 Build Project</a></li><li><a href=#333-program-fpga aria-label="3.3.3 Program FPGA">3.3.3 Program FPGA</a></li></ul></li></ul></li><li><a href=#4-links aria-label="4 Links">4 Links</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=1-introduction>1 Introduction<a hidden class=anchor aria-hidden=true href=#1-introduction>#</a></h1><p>This post is a step-by-step guide implementing a blinking LED project with MicroBlaze:</p><ul><li>Create a minimal MicroBlaze project</li><li>Sample code for blinking LED (based on a Xilinx demo)</li><li>Implementation on the demo board</li></ul><p>I am new to FPGA and MicroBlaze, and I learned these all from the tutorials I found. References are at the end.</p><p>I used:</p><ul><li>Device: xc7a35tfgg484-2, (an Artix-7 Mini board made by a Chinese company, Wildfire)</li><li>Vivado 2018.3</li></ul><h1 id=2-in-vivado>2 In Vivado<a hidden class=anchor aria-hidden=true href=#2-in-vivado>#</a></h1><p>New RTL project and select the correct device.</p><h2 id=21-new-block-design>2.1 New Block Design<a hidden class=anchor aria-hidden=true href=#21-new-block-design>#</a></h2><p>IP integrator-Create Block Design.
<img loading=lazy src=/images/img_2023-05-20-2.png alt></p><h2 id=22-add-microblaze-ip>2.2 Add MicroBlaze IP<a hidden class=anchor aria-hidden=true href=#22-add-microblaze-ip>#</a></h2><p><img loading=lazy src=/images/img_2023-05-20-4.png alt></p><p>Run Block Automation:</p><ul><li>Choose <code>New Clocking Wizard</code>, because the board has a 50 MHz input clock, and the microblaze core seems to need a 100 MHz clock.</li><li>Other setting default.
<img loading=lazy src=/images/img_2023-05-20-5.png alt></li></ul><p>After block automation, a few other IPs are added and connected:
<img loading=lazy src=/images/img_2023-05-20-7.png alt></p><h2 id=23-clocking-wizard>2.3 Clocking wizard<a hidden class=anchor aria-hidden=true href=#23-clocking-wizard>#</a></h2><p><img loading=lazy src=/images/img_2023-05-20-6.png alt></p><ul><li><code>Input Clock-Source-single ended clock capable</code> , also, correct frequency, <code>50 MHz</code>.</li><li><code>Output Clocks-Reset Type-select Active Low</code>, to matching the schematics below (<code>KEY1</code> is Low when the button is pushed):
<img loading=lazy src=/images/img_2023-05-20-8.png alt></li></ul><h2 id=24-connection-automation>2.4 Connection Automation<a hidden class=anchor aria-hidden=true href=#24-connection-automation>#</a></h2><p><code>Run Connection Automation</code>:
<img loading=lazy src=/images/img_2023-05-20-21.png alt>
(I don&rsquo;t know how this button can be accessed from the menu&mldr;)</p><p>Input ports for <code>reset</code> and <code>clock</code> are added automatically:</p><ul><li>The generated port name was <code>clk_100MHZ</code>, I changed it to <code>clk_50MHZ</code>, to avoid confusion</li><li>Two reset ports were generated, and I merged them into one.
<img loading=lazy src=/images/img_2023-05-20-11.png alt></li></ul><blockquote><p><code>Regenerate Layout</code>: useful button to organize the schematics.</p></blockquote><p><img loading=lazy src=/images/img_2023-05-20-10.png alt></p><h2 id=25-add-axi_gpio>2.5 Add AXI_GPIO<a hidden class=anchor aria-hidden=true href=#25-add-axi_gpio>#</a></h2><p>Add <code>AXI_GPIO</code> IP.
I have 4 user LEDs on the board, so I selected <code>GPIO Width=4</code>, and <code>All Outputs</code>.
<img loading=lazy src=/images/img_2023-05-20-12.png alt></p><p><code>Run Connection Automation</code> again, GPIO IP is automaticly connected to the Microblaze system, meanwhile, an output port was added to the block dragram.
<img loading=lazy src=/images/img_2023-05-20-13.png alt></p><h2 id=26-validate-design>2.6 Validate Design<a hidden class=anchor aria-hidden=true href=#26-validate-design>#</a></h2><p><img loading=lazy src=/images/img_2023-05-20-14.png alt>
Successful.</p><h2 id=27-create-wrapper-top-level-design>2.7 Create wrapper (top level design)<a hidden class=anchor aria-hidden=true href=#27-create-wrapper-top-level-design>#</a></h2><p>Automaticaly generate a top level design for the project.
<img loading=lazy src=/images/img_2023-05-20-15.png alt>
The final structure: <code>top-mb1-all the IPs</code>
<img loading=lazy src=/images/img_2023-05-20-16.png alt></p><p>The generated wrapper:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=line><span class=cl><span class=k>module</span> <span class=n>mb1_wrapper</span>
</span></span><span class=line><span class=cl>   <span class=p>(</span><span class=n>clk_50MHz</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>led_tri_o</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>reset_rtl_0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>input</span> <span class=n>clk_50MHz</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>output</span> <span class=p>[</span><span class=mh>3</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span><span class=n>led_tri_o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>input</span> <span class=n>reset_rtl_0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>wire</span> <span class=n>clk_50MHz</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>wire</span> <span class=p>[</span><span class=mh>3</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span><span class=n>led_tri_o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>wire</span> <span class=n>reset_rtl_0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>mb1</span> <span class=n>mb1_i</span>
</span></span><span class=line><span class=cl>       <span class=p>(.</span><span class=n>clk_50MHz</span><span class=p>(</span><span class=n>clk_50MHz</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>led_tri_o</span><span class=p>(</span><span class=n>led_tri_o</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>reset_rtl_0</span><span class=p>(</span><span class=n>reset_rtl_0</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>endmodule</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=28-define-contraints>2.8 Define Contraints<a hidden class=anchor aria-hidden=true href=#28-define-contraints>#</a></h2><ol><li>Run Synthesis</li><li>From the top menus, <code>layout-I/O planning</code></li><li>Assign correct <code>package pins</code> and <code>I/O standard</code> for reset button, (read the schematics or documentations of your board)</li><li>Save the constraint <code>.xdc</code> file.</li></ol><p><img loading=lazy src=/images/img_2023-05-20-17.png alt></p><p>generated <code>.xdc</code> file :</p><pre tabindex=0><code>set_property PACKAGE_PIN W19 [get_ports clk_50MHz]
set_property IOSTANDARD LVCMOS33 [get_ports clk_50MHz]
set_property PACKAGE_PIN N20 [get_ports {led_tri_o[0]}]
set_property PACKAGE_PIN M20 [get_ports {led_tri_o[1]}]
set_property PACKAGE_PIN N22 [get_ports {led_tri_o[2]}]
set_property PACKAGE_PIN M22 [get_ports {led_tri_o[3]}]
set_property IOSTANDARD LVCMOS33 [get_ports {led_tri_o[3]}]
set_property IOSTANDARD LVCMOS33 [get_ports {led_tri_o[2]}]
set_property IOSTANDARD LVCMOS33 [get_ports {led_tri_o[1]}]
set_property IOSTANDARD LVCMOS33 [get_ports {led_tri_o[0]}]
set_property IOSTANDARD LVCMOS33 [get_ports reset_rtl_0]
set_property PACKAGE_PIN R16 [get_ports reset_rtl_0]
</code></pre><h2 id=29-bitstream-generation>2.9 Bitstream Generation<a hidden class=anchor aria-hidden=true href=#29-bitstream-generation>#</a></h2><p>All default settings:</p><ol><li>Implementation</li><li>Generate bitstream</li></ol><h2 id=210-export-hardware>2.10 Export Hardware<a hidden class=anchor aria-hidden=true href=#210-export-hardware>#</a></h2><p>File-export-export Hardware with default settings.</p><p><img loading=lazy src=/images/img_2023-05-20-18.png alt></p><h2 id=211-open-sdk>2.11 Open SDK<a hidden class=anchor aria-hidden=true href=#211-open-sdk>#</a></h2><p>File-Launch SDK</p><h1 id=3-in-sdk>3 In SDK<a hidden class=anchor aria-hidden=true href=#3-in-sdk>#</a></h1><h2 id=31-new-application-project>3.1 New Application Project<a hidden class=anchor aria-hidden=true href=#31-new-application-project>#</a></h2><ol start=2><li>In SDK, New-Application Project</li><li>Finish, create an empty project</li></ol><p><img loading=lazy src=/images/img_2023-05-20-19.png alt></p><h2 id=32-add-sample-code>3.2 Add Sample Code<a hidden class=anchor aria-hidden=true href=#32-add-sample-code>#</a></h2><p>Add <code>main.c</code> at <code>src</code> directory.
<img loading=lazy src=/images/img_2023-05-20-22.png alt></p><p>main.c:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;xil_printf.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;xgpio.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;xparameters.h&#34; //for device id</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>XGpio</span> <span class=n>led_gpio</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#define LED_DELAY 	5000000
</span></span></span><span class=line><span class=cl><span class=cp>#define LED_CHANNEL 1
</span></span></span><span class=line><span class=cl><span class=cp>#define DIR_OUTPUT 	0
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>volatile</span> <span class=kt>int</span> <span class=n>counter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// XPAR_GPIO_LED_DEVICE_ID: see xparameters.h
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// GPIO_LED is the name of the AXI_GPIO IP from Vivado
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>status</span> <span class=o>=</span> <span class=nf>XGpio_Initialize</span><span class=p>(</span><span class=o>&amp;</span><span class=n>led_gpio</span><span class=p>,</span> <span class=n>XPAR_GPIO_LED_DEVICE_ID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>status</span> <span class=o>!=</span> <span class=n>XST_SUCCESS</span><span class=p>)</span> <span class=c1>//if status!=0
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>//comment out xil_printf, because the RAM was small, 8KB
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>//xil_printf(&#34;Gpio Initialization Failed\r\n&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=n>XST_FAILURE</span><span class=p>;</span> <span class=c1>//return 1
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nf>XGpio_SetDataDirection</span><span class=p>(</span><span class=o>&amp;</span><span class=n>led_gpio</span><span class=p>,</span> <span class=n>LED_CHANNEL</span><span class=p>,</span> <span class=n>DIR_OUTPUT</span><span class=p>);</span> <span class=c1>//all bits as output
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Set the GPIO bits to High
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nf>XGpio_DiscreteWrite</span><span class=p>(</span><span class=o>&amp;</span><span class=n>led_gpio</span><span class=p>,</span> <span class=n>LED_CHANNEL</span><span class=p>,</span> <span class=mh>0x0F</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=n>counter</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>counter</span><span class=o>&lt;</span><span class=n>LED_DELAY</span><span class=p>;</span><span class=n>counter</span><span class=o>++</span><span class=p>);</span> <span class=c1>//delay
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>		<span class=c1>// Set the GPIO bits to Low
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nf>XGpio_DiscreteWrite</span><span class=p>(</span><span class=o>&amp;</span><span class=n>led_gpio</span><span class=p>,</span> <span class=n>LED_CHANNEL</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=n>counter</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>counter</span><span class=o>&lt;</span><span class=n>LED_DELAY</span><span class=p>;</span><span class=n>counter</span><span class=o>++</span><span class=p>);</span> <span class=c1>//delay
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>XST_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>For initialization of GPIO, refer to <code>xgpio_example.c</code>: <a href=https://xilinx.github.io/embeddedsw.github.io/gpio/doc/html/api/xgpio__example_8c.html#a840291bc02cba5474a4cb46a9b9566fe>gpio: xgpio_example.c File Reference</a></li><li>For device id, look for <code>GPIO_LED</code> (the name of <code>AXI_GPIO</code> ip from Vivado Block Design) in <code>xparameters.h</code>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define XPAR_GPIO_LED_DEVICE_ID 0
</span></span></span><span class=line><span class=cl><span class=cp>#define XPAR_GPIO_0_DEVICE_ID XPAR_GPIO_LED_DEVICE_ID
</span></span></span></code></pre></td></tr></table></div></div><h2 id=33-debug>3.3 Debug<a hidden class=anchor aria-hidden=true href=#33-debug>#</a></h2><h3 id=331-run-configuration>3.3.1 Run Configuration<a hidden class=anchor aria-hidden=true href=#331-run-configuration>#</a></h3><p><img loading=lazy src=/images/img_2023-05-20-23.png alt></p><p><img loading=lazy src=/images/img_2023-05-20-24.png alt></p><h3 id=332-build-project>3.3.2 Build Project<a hidden class=anchor aria-hidden=true href=#332-build-project>#</a></h3><p>Project-Build All</p><h3 id=333-program-fpga>3.3.3 Program FPGA<a hidden class=anchor aria-hidden=true href=#333-program-fpga>#</a></h3><p>Right click Project <code>led</code>-Run as-Launch on Hardware.</p><p>After a few seconds, the LEDs should be blinking.
<img loading=lazy src=/images/img_2023-05-20-25.png alt></p><p>Basically, the SDK is just like other IDEs for ARM or TI DSP, though I haven&rsquo;t used these in a while, either.</p><h1 id=4-links>4 Links<a hidden class=anchor aria-hidden=true href=#4-links>#</a></h1><p>Maybe I should have used a newer Vivado version:</p><blockquote><p>Starting in the <strong>2019.2 release</strong>, the Xilinx SDK development environment is unified into an all-in-one Vitis™ unified software platform.</p></blockquote><ol><li>Most of the steps are from this video: <a href="https://www.youtube.com/watch?v=nxPOGmTDLns">Digilent Nexys: Microblaze and GPIO Design Implementation - YouTube</a></li><li>Another toturial: <a href=https://www.xilinx.com/video/software/microblaze-quickstart-video.html>MicroBlaze Quickstart Video</a></li><li>volatile int: <a href=https://stackoverflow.com/questions/246127/why-is-volatile-needed-in-c/>declaration - Why is volatile needed in C? - Stack Overflow</a><ol><li><code>volatile</code> tells the compiler not to optimize anything that has to do with the <code>volatile</code> variable.</li></ol></li><li><a href="https://support.xilinx.com/s/question/0D52E00006hpZUBSA2/microblaze-section-text-will-not-fit-in-region?language=en_US">MicroBlaze - section .text will not fit in region (xilinx.com)</a></li><li><a href="https://support.xilinx.com/s/article/1050061?language=en_US#:~:text=Starting%20in%20the%202019.2%20release,Vitis%E2%84%A2%20unified%20software%20platform.">Step By Step Guide To Xilinx SDK Project Migration To Vitis</a></li><li><a href=https://xilinx.github.io/embeddedsw.github.io/gpio/doc/html/api/xgpio__example_8c.html#a840291bc02cba5474a4cb46a9b9566fe>gpio: xgpio_example.c File Reference</a><ol><li>search for <code>xgpio_example.c</code> inside the Vivado installation directory.</li></ol></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=qygong17.github.io/tags/microblaze/>microblaze</a></li></ul><nav class=paginav><a class=prev href=qygong17.github.io/posts/microblaze2-boot-from-qspi-flash-no-bootloader/><span class=title>« Prev</span><br><span>Microblaze2 Boot from QSPI Flash (No bootloader)</span></a>
<a class=next href=qygong17.github.io/posts/python-script-for-publishing-blog-posts-from-obsidian/><span class=title>Next »</span><br><span>Python script for publishing blog posts from Obsidian</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=qygong17.github.io>QY's Notes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>